---

title : "밑바닥부터 시작하는 딥러닝 - 5 오차역전파법(back propagation)"
date : 2019-08-04 10:00:00 + 0000
tags: DeepLearning
category: DeepLearning

---

# Intro
이번 포스트에서는 [밑바닥부터 시작하는 딥러닝](https://github.com/WegraLee/deep-learning-from-scratch) **오류 역전파법** 을 공부하며 잊어버리지 않기 위해 이해한 내용을 정리하였다.

***

# 1. 계산 그래프
- 계산 그래프(computational graph): 계산 과정을 그래프로 나타낸 것
- 그래프(graph): 복수의 노드(node)와 에지(edge)로 구성

## 1-1. 계산 그래프로 풀다
계산 그래프는 계산 과정을 노드와 화살표로 표현한다. 노드는 원(O)으로 표현하고 원 안에 연산 내용을 적는다. 또 계산 결과를 화살표 위에 적어, 각 노드의 계산 결과가 화살표 방향으로 전해지게 한다.

예시)
문제: 린구가 카페에서 카페모카 2잔, 케익 4개를 샀다. 카페모카는 1잔에 1500원, 케익은 1개에 500원이다. 소비세가 10%일 때 지불 금액을 구하라.

계산 그래프:
![딥러닝5](/assets/images/2019-08-04-밑바닥부터 시작하는 딥러닝 5/1.PNG){: width="900" height="700"}

계산 그래프를 이용한 문제 풀이는 다음 흐름으로 진행된다.
1. 계산 그래프를 구성한다.
2. 그래프에서 계산을 왼쪽에서 오른쪽으로 진행한다.
=> 왼쪽에서 오른쪽으로 진행하는 단계를 **순전파(forward propagation)** 라고 한다.
=> 오른쪽에서 왼쪽으로 진행하는 것은 **역전파(back propagation)** 라고 한다.

## 1-2. 국소적 계산
국소적 계산이란 전체에서 어떤 일이 벌어지든 상관 없이 자신과 관계된 국소 범위의 정보만으로 결과를 출력하는 것을 말한다.
계산 그래프에서 전체 계산이 아무리 복잡해도 각 단계에서 하는 일은 해당 노드의 국소적 계산이다.
=> 단순하지만, 그 결과를 전달함으로써 전체를 구성하는 복잡한 계산을 완성할 수 있다.

## 1-3. 계산 그래프의 장점
- 국소적 계산: 전체가 아무리 복잡해도 각 노드에서는 단순한 계산에 집중해서 문제를 단순화할 수 있다.
- 역전파를 통해 '미분'을 효율적으로 계산할 수 있다.
예를 들면, 카페모카를 x, 지불 금액을 L이라고 했을 때 카페모카 값이 아주 조금 올랐을 때, 지불 금액이 얼마나 증가하는지 알 수 있다($\frac{\partial L}{\partial x}$).
사과 가격에 대한 미분과 마찬가지로, 소비세에 대한 지불 금액의 미분, 사과 개수에 대한 지불 금액의 미분도 구할 수 있다.

***

# 2. 연쇄 법칙
국소적 미분을 전달하는 원리는 연쇄법칙(chain rule)에 따른 것이다.

## 2-1. 계산 그래프의 역전파
역전파의 간단한 예제를 살펴보자.
$y=f(x)$
위 수식의 역전파 그래프는 다음과 같다.
![딥러닝5](/assets/images/2019-08-04-밑바닥부터 시작하는 딥러닝 5/2.png){: width="900" height="700"}

역전파의 계산 절차는 신호 E에 노드의 국소적 미분을 곱한 후 앞 쪽 노드로 전달하는 것이다.
- 국소적 미분: y=f(x)의 미분
- 미분을 상류에서 전달된 값: 여기서는 E.
이러한 방식을 따르면 목표로 하는 미분 값을 효율적으로 구할 수 있다는 것이 이 전파의 핵심이다. 왜 이런일이 가능한가를 연쇄 법칙의 원리로 설명할 수 있다.


## 2-2. 연쇄 법칙이란
연쇄 법칙을 설명하려면 합성함수를 이해해야 한다. 합성 함수란 여러 함수로 구성되 함수이다.
예시)
$$z=t^2$$
$$t=x+y$$

연쇄 법칙은 합성 함수의 미분에 대한 성질이며, 다음과 같이 정의 된다.
**"합성 함수의 미분은 합성 함수를 구성하는 각 함수의 미분의 곱으로 나타낼 수 있다."**

$\frac{\partial z}{\partial x}$ ($x$에 대한 $z$의 미분)은 $\frac{\partial z}{\partial t}$($t$에 대한 $z$의 미분)과 $\frac{\partial t}{\partial x}$($x$에 대한 $t$의 미분)의 곱으로 나타낼 수 있다는 것이다.

$\frac{\partial z}{\partial x}$ = $\frac{\partial z}{\partial t}$$\frac{\partial t}{\partial x}$

연쇄 법칙을 통해 미분 $\frac{\partial z}{\partial x}$을 구해보자.
먼저 국소적 미분(편미분)을 구한다.
 $\frac{\partial z}{\partial t}$ = $2t$
 $\frac{\partial t}{\partial x}$ = $1$

그리고 최종적으로 두 국소적 미분을 곱하면 된다.
따라서 $\frac{\partial z}{\partial x}$ = $\frac{\partial z}{\partial t}$$\frac{\partial t}{\partial x}$ = $2t*1$ = $2(x+y)$

## 2-3. 연쇄 법칙과 계산 그래프
위의 연쇄 법칙 계산을 계산 그래프로 나타내면 다음과 같다.
![딥러닝5](/assets/images/2019-08-04-밑바닥부터 시작하는 딥러닝 5/3.png){: width="900" height="700"}

역전파는 오른쪽에서 왼쪽으로 신호를 전파하는데, 노드로 들어온 입력 신호에 그 노드이 국소적 미분(편미분)을 곱한 후 다음 노드로 전달한다. 예를 들어 $**2 노드에서 역전파를 보자.

입력은 $\frac{\partial z}{\partial z}$ 이며, 이에 국소적 미분인 $\frac{\partial z}{\partial t}$(순전파 시에 입력이 $t$이고, 출력이 $z$이므로 이 노드에서 국소적 미분은 $\frac{\partial z}{\partial t}$이다)를 곱하고 다음 노드로 넘긴다.

주목할 점은, 맨 왼쪽 역전파인데, 이 계산은 연쇄 법칙에 따르면 $\frac{\partial z}{\partial z}$$\frac{\partial z}{\partial t}$$\frac{\partial t}{\partial x}$ = $\frac{\partial z}{\partial t}$$\frac{\partial t}{\partial x}$ = $\frac{\partial z}{\partial x}$ 가 성립되어, '$x$에 대한 $z$의 미분'이 된다.

즉 역전파가 하는 일은 연쇄 법칙의 원리와 같다.

***

# 3. 역전파

다음으로 PHP 프로그래밍 모듈을 동작시켜보자.

```
cd /var/www/html

# phpinfo.php 파일 생성
vi phpinfo.php

# 파일 내에 php 함수를 작성하여, php 모듈이 정상 작동하는지 확인
<?php phpinfo();  ?>

```
![WebServer2](/assets/images/2019-06-11-WebServer1/2.PNG){: width="900" height="700"}

localhost/phpinfo.php 주소로 접속했을때, 아래와 같이 화면에 출력되면 php가 정상적으로 작동하고 있는 것이다.

![WebServer3](/assets/images/2019-06-11-WebServer1/3.PNG){: width="900" height="700"}

***

# 4. XpressEngine을 사용하여 웹 사이트 구축하기

## 4-1. XpressEngine이란?

(작성중)

## 4-2. XpressEngine 설치하기

**1) XpressEngine을 설치하기 위해서 다음과 같이 사전 작업을 진행해준다.**

```
apt-get -y install php php-gd php-xml
```

**2) XpressEngine 설치 파일을 다운로드 한다.**

[Express Engine 설치 사이트](https://xpressengine.com/download)에서 XE Core를 다운로드 한다.

![WebServer4](/assets/images/2019-06-11-WebServer1/4.png){: width="900" height="700"}

**3) 설치 파일을 /var/www/html로 옮기고 압축을 풀어준다.**

```
mv /root/다운로드/xe.zip /var/www/html/
cd /var/www/html/

unzip xe.zip

# 외부 사용자가 xe 서버에 접근할 수 있도록, xe 폴더의 권한을 변경해준다.
chmod 707 xe
```

압축을 풀어준 후에 /var/www/html/xe/modules/board 디렉토리를 확인해보자. 이 디렉토리는 게시판으로 사용된다.

**4) XpressEngine 데이터 베이스를 생성한다.**

```
# root 계정으로 mysql 접속
mysql -u root -p{패스워드}

# xeUser 생성 및 권한 부여
GRANT ALL PRIVILEGES ON xeDB.* TO xeUser@localhost IDENTIFIED BY '{패스워드}';

# mysql 종료
exit

# 새로 생성한 mysql 계정으로 mysql 접속
mysql -u xeUser -p{패스워드}

# xeDB 생성
CREATE DATABASE xeDB;

# mysql 종료
exit
```

**5) XpressEngine 웹 서버에 접속(http://{서버 IP}/xe/)하여 설정을 완료한다.**

아래의 순서에 따라 설정 및 확인을 해주면 된다.

- 한국어 선택
- 사용권 동의
- 설치 조건: 설치가 가능한지 확인
- mysqli

- mysqli 정보 입력
![WebServer5](/assets/images/2019-06-11-WebServer1/5.png){: width="900" height="700"}

- Korea Standard Time, Japan Standard Time 선택
- 관리자 정보 입력

정상적으로 완료되면, 아래와 같이 초기 화면이 출력된다.

![WebServer6](/assets/images/2019-06-11-WebServer1/6.PNG){: width="900" height="700"}

***

이렇게 간단하게 APM을 설치하고 XpressEngine을 이용하여 웹 서버를 운영하는 방법을 알아보았다.
